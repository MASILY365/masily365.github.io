<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="google-site-verification" content="3oSn5K2MntAfuLQcm6vulA63s7_VAXKoe07BCg-ssYo"><meta name="baidu-site-verification" content="code-0nqJkNFlCi"><title>MASILY</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="MASILY"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="MASILY"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="程序员个人博客，用于记录日常学习内容、生活琐事等。主要的技术内容有 Java、Spring、SpringBoot、MySQL、SQL Server、Mybatis、React、Kafka、Redis等"><meta property="og:type" content="blog"><meta property="og:title" content="MASILY"><meta property="og:url" content="https://masily365.github.io/"><meta property="og:site_name" content="MASILY"><meta property="og:description" content="程序员个人博客，用于记录日常学习内容、生活琐事等。主要的技术内容有 Java、Spring、SpringBoot、MySQL、SQL Server、Mybatis、React、Kafka、Redis等"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://masily365.github.io/img/og_image.png"><meta property="article:author" content="masily"><meta property="article:tag" content="后端,Java,Spring,SpringBoot,SpringCloud,Kafka,Web,React"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://masily365.github.io"},"headline":"MASILY","image":["https://masily365.github.io/img/og_image.png"],"author":{"@type":"Person","name":"masily"},"publisher":{"@type":"Organization","name":"MASILY","logo":{"@type":"ImageObject","url":"https://masily365.github.io/img/favicon.svg"}},"description":"程序员个人博客，用于记录日常学习内容、生活琐事等。主要的技术内容有 Java、Spring、SpringBoot、MySQL、SQL Server、Mybatis、React、Kafka、Redis等"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?6d1c7c935a93216ffe64dc1c70e60432";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-XBWW0FFMX2" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-XBWW0FFMX2');</script><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><script data-ad-client="ca-pub-3160477308855244" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 6.1.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.svg" alt="MASILY" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/MASILY365/masily365.github.io"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/MASILY365/masily365.github.io/discussions"><i class="fas fa-comments"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-05-07T06:04:46.017Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.017Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item">5 分钟读完 (大约704个字)</span></div></div><div class="content"><h1 id="springboot-websocket"><a href="#springboot-websocket" class="headerlink" title="springboot websocket"></a>springboot websocket</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p><code>springboot</code> 	<code>2.3.5.RELEASE</code></p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="传统方式使用websocket"><a href="#传统方式使用websocket" class="headerlink" title="传统方式使用websocket"></a>传统方式使用websocket</h3><ol>
<li>依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--虽然springboot中存在websocket依赖，但是使用传统开发还是需要该依赖--&gt;</span>       <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>   <br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>配置</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.masily.websocket;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.socket.server.standard.ServerEndpointExporter;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketConfig</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 这个bean会自动注册使用了<span class="hljs-doctag">@ServerEndpoint</span>注解声明的对象</span><br><span class="hljs-comment">     * 没有的话会报404</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServerEndpointExporter <span class="hljs-title function_">serverEndpointExporter</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerEndpointExporter</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>websocket逻辑</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.masily.websocket;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> com.masily.websocket.entity.Message;<br><span class="hljs-keyword">import</span> lombok.*;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> javax.websocket.*;<br><span class="hljs-keyword">import</span> javax.websocket.server.ServerEndpoint;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.concurrent.CopyOnWriteArraySet;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> masily</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2020-12-15 08:29:26</span><br><span class="hljs-comment"> * 类似Servlet的注解mapping。无需在web.xml中配置。</span><br><span class="hljs-comment"> * configurator = SpringConfigurator.class是为了使该类可以通过Spring注入。好像还需要添加的jar为：spring-websocket-4.3.8.RELEASE 暂且不用</span><br><span class="hljs-comment"> * 当前 objectMapper 会无法注入 null</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-comment">// @ServerEndpoint(value = &quot;/websocket/chat&quot;, configurator = SpringConfigurator.class)</span><br><span class="hljs-meta">@ServerEndpoint(value = &quot;/websocket/chat&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWebSocket</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> ObjectMapper objectMapper;<br><br>    <span class="hljs-keyword">private</span> Session session;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 静态变量，用来记录当前在线连接数。应该把它设计成线程安全的。</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">onLineCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * concurrent包的线程安全Set，用来存放每个客户端对应的MyWebSocket对象。</span><br><span class="hljs-comment">     * 若要实现服务端与单一客户端通信的话，可以使用Map来存放，其中Key可以为用户标识</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CopyOnWriteArraySet&lt;MyWebSocket&gt; webSocketSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArraySet</span>&lt;&gt;();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 连接建立成功调用的方法</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> session 可选的参数。session为与某个客户端的连接会话，需要通过它来给客户端发送数据</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@OnOpen</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onOpen</span><span class="hljs-params">(Session session)</span> &#123;<br>        <span class="hljs-built_in">this</span>.session = session;<br>        <span class="hljs-comment">//加入set中</span><br>        webSocketSet.add(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-comment">//在线数加1</span><br>        addOnlineCount();<br>        log.info(<span class="hljs-string">&quot;有新连接加入！当前在线人数为&quot;</span> + onLineCount);<br>        sendOnLineCountMessage();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 连接关闭调用的方法</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@OnClose</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//从set中删除</span><br>        webSocketSet.remove(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-comment">//在线数减1</span><br>        subOnlineCount();<br>        log.info(<span class="hljs-string">&quot;有一连接关闭！当前在线人数为&quot;</span> + onLineCount);<br>        sendOnLineCountMessage();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 收到客户端消息后调用的方法</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message 客户端发送过来的消息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> session 可选的参数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@OnMessage</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String message, Session session)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;来自客户端的消息:&quot;</span> + message);<br>        <span class="hljs-comment">//群发消息</span><br>        groupSendMessage(Message.sendMessage(message));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 发生错误时调用</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> session 可选的参数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> error   异常</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@OnError</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Session session, Throwable error)</span> &#123;<br>        log.error(<span class="hljs-string">&quot;发生错误,session:&#123;&#125;,e:&#123;&#125;&quot;</span>, session, error);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 这个方法与上面几个方法不一样。没有用注解，是根据自己需要添加的方法。</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message 客户端发送过来的消息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(Message&lt;T&gt; message)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(message);<br>        <span class="hljs-built_in">this</span>.session.getBasicRemote().sendText(msg);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 发送在线数量</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOnLineCountMessage</span><span class="hljs-params">()</span> &#123;<br>        groupSendMessage(Message.sendOnLineCount(onLineCount));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">groupSendMessage</span><span class="hljs-params">(Message&lt;T&gt; message)</span> &#123;<br>        <span class="hljs-keyword">for</span> (MyWebSocket item : webSocketSet) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                item.sendMessage(message);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addOnlineCount</span><span class="hljs-params">()</span> &#123;<br>        MyWebSocket.onLineCount++;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subOnlineCount</span><span class="hljs-params">()</span> &#123;<br>        MyWebSocket.onLineCount--;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="使用最新的开发"><a href="#使用最新的开发" class="headerlink" title="使用最新的开发"></a>使用最新的开发</h3></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-05-07T06:04:46.017Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.017Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item">1 分钟读完 (大约199个字)</span></div></div><div class="content"><h1 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h1><h2 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;2&#x27;</span><br><span class="hljs-attr">services:</span><br>    <span class="hljs-attr">zoo1:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">zookeeper</span><br>        <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>        <span class="hljs-attr">container_name:</span> <span class="hljs-string">zoo1</span><br>        <span class="hljs-comment"># 本地地址：容器内部地址</span><br>        <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;2181:2181&quot;</span><br>        <span class="hljs-attr">environment:</span><br>        	<span class="hljs-comment"># ZK 服务的 id, 它是1-255 之间的整数, 必须在集群中唯一.</span><br>            <span class="hljs-attr">ZOO_MY_ID:</span> <span class="hljs-number">1</span><br>            <span class="hljs-comment"># ZK 集群的主机列表.</span><br>            <span class="hljs-attr">ZOO_SERVERS:</span> <span class="hljs-string">server.1=zoo1:2888:3888</span> <span class="hljs-string">server.2=zoo2:2888:3888</span> <span class="hljs-string">server.3=zoo3:2888:3888</span><br><br>    <span class="hljs-attr">zoo2:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">zookeeper</span><br>        <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>        <span class="hljs-attr">container_name:</span> <span class="hljs-string">zoo2</span><br>        <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;2182:2181&quot;</span><br>        <span class="hljs-attr">environment:</span><br>            <span class="hljs-attr">ZOO_MY_ID:</span> <span class="hljs-number">2</span><br>            <span class="hljs-attr">ZOO_SERVERS:</span> <span class="hljs-string">server.1=zoo1:2888:3888</span> <span class="hljs-string">server.2=zoo2:2888:3888</span> <span class="hljs-string">server.3=zoo3:2888:3888</span><br><br>    <span class="hljs-attr">zoo3:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">zookeeper</span><br>        <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>        <span class="hljs-attr">container_name:</span> <span class="hljs-string">zoo3</span><br>        <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;2183:2181&quot;</span><br>        <span class="hljs-attr">environment:</span><br>            <span class="hljs-attr">ZOO_MY_ID:</span> <span class="hljs-number">3</span><br>            <span class="hljs-attr">ZOO_SERVERS:</span> <span class="hljs-string">server.1=zoo1:2888:3888</span> <span class="hljs-string">server.2=zoo2:2888:3888</span> <span class="hljs-string">server.3=zoo3:2888:3888</span><br></code></pre></td></tr></table></figure>

<h2 id="zookeeper-相关配置"><a href="#zookeeper-相关配置" class="headerlink" title="zookeeper 相关配置"></a>zookeeper 相关配置</h2><h3 id="zookeeper-的三个端口作用"><a href="#zookeeper-的三个端口作用" class="headerlink" title="zookeeper 的三个端口作用"></a>zookeeper 的三个端口作用</h3><ul>
<li>2181 : 对 client 端提供服务</li>
<li>2888 : 集群内机器通信使用</li>
<li>3888 : 选举 leader 使用</li>
</ul>
<h3 id="zookeeper-集群配置"><a href="#zookeeper-集群配置" class="headerlink" title="zookeeper 集群配置"></a>zookeeper 集群配置</h3><p>按 server.id &#x3D; ip:port:port 修改集群配置文件:</p>
<p>三台虚拟机 zoo.cfg 文件末尾添加配置:</p>
<ul>
<li>server.1&#x3D;192.168.3.33:2888:3888</li>
<li>server.2&#x3D;192.168.3.35:2888:3888</li>
<li>server.3&#x3D;192.168.3.37:2888:3888</li>
</ul>
<p>根据 id 和对应的地址分别配置 <code>myid</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /tmp/zookeeper/myid<br></code></pre></td></tr></table></figure>

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item">10 分钟读完 (大约1428个字)</span></div></div><div class="content"><h2 id="内存可见性"><a href="#内存可见性" class="headerlink" title="内存可见性"></a>内存可见性</h2><p>由于 <code>Java</code> 内存模型(<code>JMM</code>)规定，所有的变量都存放在主内存中，而每个线程都有着自己的工作内存(高速缓存)。</p>
<p>线程在工作时，需要将主内存中的数据拷贝到工作内存中。这样对数据的任何操作都是基于工作内存(效率提高)，并且不能直接操作主内存以及其他线程工作内存中的数据，之后再将更新之后的数据刷新到主内存中。</p>
<blockquote>
<p>这里所提到的主内存可以简单认为是<strong>堆内存</strong>，而工作内存则可以认为是<strong>栈内存</strong>。</p>
</blockquote>
<p>如下图所示：</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2019/05/08/5cd1ba249e161.jpg"><img src="https://i.loli.net/2019/05/08/5cd1ba249e161.jpg"></a></p>
<p>所以在并发运行时可能会出现线程 B 所读取到的数据是线程 A 更新之前的数据。</p>
<p>显然这肯定是会出问题的，因此 <code>volatile</code> 的作用出现了：</p>
<blockquote>
<p>当一个变量被 <code>volatile</code> 修饰时，任何线程对它的写操作都会立即刷新到主内存中，并且会强制让缓存了该变量的线程中的数据清空，必须从主内存重新读取最新数据。</p>
</blockquote>
<p><em><code>volatile</code> 修饰之后并不是让线程直接从主内存中获取数据，依然需要将变量拷贝到工作内存中</em>。</p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>当我们需要在两个线程间依据主内存通信时，通信的那个变量就必须的用 <code>volatile</code> 来修饰：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPool</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">initFlag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;wait true&quot;</span>);<br>            <span class="hljs-keyword">while</span> (!initFlag) &#123;<br><br>            &#125;<br>            System.out.println(<span class="hljs-string">&quot;=============== init SUCCESS&quot;</span>);<br>        &#125;).start();<br>        Thread.sleep(<span class="hljs-number">20000</span>);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; build()).start();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">build</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;prepare data start&quot;</span>);<br>        initFlag = <span class="hljs-literal">true</span>;<br>        System.out.println(<span class="hljs-string">&quot;prepare data end&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>主线程在修改了标志位使得线程 A 立即停止，如果没有用 <code>volatile</code> 修饰，就有可能出现延迟。</p>
<p>但这里有个误区，这样的使用方式容易给人的感觉是：</p>
<blockquote>
<p>对 <code>volatile</code> 修饰的变量进行并发操作是线程安全的。</p>
</blockquote>
<p>这里要重点强调，<code>volatile</code> 并<strong>不能</strong>保证线程安全性！</p>
<p>如下程序:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VolatileInc</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; <span class="hljs-comment">//使用 volatile 修饰基本数据内存不能保证原子性</span><br>    <span class="hljs-comment">//private static AtomicInteger count = new AtomicInteger() ;</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10000</span> ;i++)&#123;<br>            count ++ ;<br>            <span class="hljs-comment">//count.incrementAndGet() ;</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">VolatileInc</span> <span class="hljs-variable">volatileInc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VolatileInc</span>() ;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(volatileInc,<span class="hljs-string">&quot;t1&quot;</span>) ;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(volatileInc,<span class="hljs-string">&quot;t2&quot;</span>) ;<br>        t1.start();<br>        <span class="hljs-comment">//t1.join();</span><br>        t2.start();<br>        <span class="hljs-comment">//t2.join();</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10000</span> ;i++)&#123;<br>            count ++ ;<br>            <span class="hljs-comment">//count.incrementAndGet();</span><br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;最终Count=&quot;</span>+count);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>当我们三个线程(t1,t2,main)同时对一个 <code>int</code> 进行累加时会发现最终的值都会小于 30000。</p>
<blockquote>
<p>这是因为虽然 <code>volatile</code> 保证了内存可见性，每个线程拿到的值都是最新值，但 <code>count ++</code> 这个操作并不是原子的，这里面涉及到获取值、自增、赋值的操作并不能同时完成。</p>
</blockquote>
<ul>
<li>所以想到达到线程安全可以使这三个线程串行执行(其实就是单线程，没有发挥多线程的优势)。</li>
<li>也可以使用 <code>synchronize</code> 或者是锁的方式来保证原子性。</li>
<li>还可以用 <code>Atomic</code> 包中 <code>AtomicInteger</code> 来替换 <code>int</code>，它利用了 <code>CAS</code> 算法来保证了原子性。</li>
</ul>
<h2 id="指令重排"><a href="#指令重排" class="headerlink" title="指令重排"></a>指令重排</h2><p>内存可见性只是 <code>volatile</code> 的其中一个语义，它还可以防止 <code>JVM</code> 进行指令重排优化。</p>
<p>举一个伪代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> a=<span class="hljs-number">10</span> ;<span class="hljs-comment">//1</span><br><span class="hljs-type">int</span> b=<span class="hljs-number">20</span> ;<span class="hljs-comment">//2</span><br><span class="hljs-type">int</span> c= a+b ;<span class="hljs-comment">//3</span><br></code></pre></td></tr></table></figure>

<p>一段特别简单的代码，理想情况下它的执行顺序是：<code>1&gt;2&gt;3</code>。但有可能经过 <code>JVM</code> 优化之后的执行顺序变为了 <code>2&gt;1&gt;3</code>。</p>
<p>可以发现不管 <code>JVM</code> 怎么优化，前提都是保证单线程中最终结果不变的情况下进行的。</p>
<p>可能这里还看不出有什么问题，那看下一段伪代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String,String&gt; value ;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> fasle ;<br><br><span class="hljs-comment">//以下方法发生在线程 A 中 初始化 Map</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initMap</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-comment">//耗时操作</span><br>	value = getMapValue() ;<span class="hljs-comment">//1</span><br>	flag = <span class="hljs-literal">true</span> ;<span class="hljs-comment">//2</span><br>&#125;<br><br><span class="hljs-comment">//发生在线程 B中 等到 Map 初始化成功进行其他操作</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomeThing</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-keyword">while</span>(!flag)&#123;<br>		sleep() ;<br>	&#125;<br>	<span class="hljs-comment">//dosomething</span><br>	doSomeThing(value);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里就能看出问题了，当 <code>flag</code> 没有被 <code>volatile</code> 修饰时，<code>JVM</code> 对 1 和 2 进行重排，导致 <code>value</code> 都还没有被初始化就有可能被线程 B 使用了。</p>
<p>所以加上 <code>volatile</code> 之后可以防止这样的重排优化，保证业务的正确性。</p>
<h3 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h3><p>一个经典的使用场景就是双重懒加载的单例模式了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton singleton;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (singleton == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;<br>                <span class="hljs-keyword">if</span> (singleton == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">//防止指令重排</span><br>                    singleton = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> singleton;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里的 <code>volatile</code> 关键字主要是为了防止指令重排。</p>
<p>如果不用 ，<code>singleton = new Singleton();</code>，这段代码其实是分为三步：</p>
<ul>
<li>分配内存空间。(1)</li>
<li>初始化对象。(2)</li>
<li>将 <code>singleton</code> 对象指向分配的内存地址。(3)</li>
</ul>
<p>加上 <code>volatile</code> 是为了让以上的三步操作顺序执行，反之有可能第二步在第三步之前被执行就有可能某个线程拿到的单例对象是还没有初始化的，以致于报错。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>volatile</code> 在 <code>Java</code> 并发中用的很多，比如像 <code>Atomic</code> 包中的 <code>value</code>、以及 <code>AbstractQueuedLongSynchronizer</code> 中的 <code>state</code> 都是被定义为 <code>volatile</code> 来用于保证内存可见性。</p>
<p>将这块理解透彻对我们编写并发程序时可以提供很大帮助。</p>
<h2 id="转载"><a href="#转载" class="headerlink" title="转载"></a>转载</h2><p><a target="_blank" rel="noopener" href="https://crossoverjie.top/2018/03/09/volatile/">原文地址</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item">2 分钟读完 (大约328个字)</span></div></div><div class="content"><h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ul>
<li>Broker：Kafka 集群包含一个或多个服务器，这种服务器被称为 broker。</li>
<li>Topic：每条发布到 Kafka 集群的消息都有一个类别，这个类别被称为 Topic。（物理上不同 Topic 的消息分开存储，逻辑上一个 Topic 的消息虽然保存于一个或多个 broker 上，但用户只需指定消息的 Topic 即可生产或消费数据而不必关心数据存于何处）。</li>
<li>Partition：Partition 是物理上的概念，每个 Topic 包含一个或多个 Partition。</li>
<li>Producer：负责发布消息到 Kafka broker。</li>
<li>Consumer：消息消费者，向 Kafka broker 读取消息的客户端。</li>
<li>Consumer Group：每个 Consumer 属于一个特定的 Consumer Group（可为每个 Consumer 指定 group name，若不指定 group name 则属于默认的 group）。</li>
</ul>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><p>可扩展性、数据分区、低延迟、处理大量不同消费者的能力</p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;2&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">zookeeper:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">wurstmeister/zookeeper</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;2181:2181&quot;</span><br>  <span class="hljs-attr">kafka:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">wurstmeister/kafka</span><br>    <span class="hljs-attr">depends_on:</span> [ <span class="hljs-string">zookeeper</span> ]<br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9092:9092&quot;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">KAFKA_ADVERTISED_HOST_NAME:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>      <span class="hljs-attr">KAFKA_ZOOKEEPER_CONNECT:</span> <span class="hljs-string">zookeeper:2181</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span><br>  <span class="hljs-attr">kafka-manager:</span>  <br>    <span class="hljs-attr">image:</span> <span class="hljs-string">kafkamanager/kafka-manager</span>               <span class="hljs-comment">## 镜像：开源的web管理kafka集群的界面</span><br>    <span class="hljs-attr">environment:</span><br>        <span class="hljs-attr">ZK_HOSTS:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>                         <span class="hljs-comment">## 修改:宿主机IP</span><br>    <span class="hljs-attr">ports:</span>  <br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9000:9000&quot;</span>                                 <span class="hljs-comment">## 暴露端口</span><br></code></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item">4 分钟读完 (大约547个字)</span></div></div><div class="content"><h1 id="MySQL主从复制"><a href="#MySQL主从复制" class="headerlink" title="MySQL主从复制"></a>MySQL主从复制</h1><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><ul>
<li>目录结构  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs text">主从复制<br> │  docker-compose.yml<br> │<br> ├─master<br> │      Dockerfile<br> │      my.cnf<br> │<br> ├─slave-1<br> │      Dockerfile<br> │      my.cnf<br> │<br> └─slave-2<br>         Dockerfile<br>         my.cnf<br></code></pre></td></tr></table></figure></li>
<li><code>docker-compose.yml</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br><br>  <span class="hljs-attr">master:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">./master</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql-master:1.0</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./master/mysql-files:/var/lib/mysql-files/&quot;</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-master</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">slave-1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">slave-2</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;33077:3306&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">mysql-master</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span><br><br>  <span class="hljs-attr">slave-1:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">./slave-1</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql-slave-1:1.0</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./slave-1/mysql-files:/var/lib/mysql-files/&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;33070:3306&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">mysql-slave-1</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-slave-1</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span><br><br>  <span class="hljs-attr">slave-2:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">./slave-2</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql-slave-2:1.0</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./slave-2/mysql-files:/var/lib/mysql-files/&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;33071:3306&quot;</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">mysql-slave-2</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-slave-2</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>master中DockerFile和my.cnf</li>
</ul>
<p>DockerFile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> mysql:latest<br><span class="hljs-keyword">MAINTAINER</span> masily<br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./my.cnf /etc/mysql/my.cnf</span><br><span class="hljs-comment">#ADD ./master/mysql-files /var/lib/mysql-files/</span><br></code></pre></td></tr></table></figure>

<p>my.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">[mysqld]<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 设置server_id，一般设置为IP，注意要唯一</span></span><br>server-id = 10<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span></span><br>log-bin = mysql-bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 主从复制的格式（mixed,statement,row，默认格式是statement）</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># binlog_format = row</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li>slave-1中DockerFile和my.cnf</li>
</ul>
<p>DockerFile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> mysql:latest<br><span class="hljs-keyword">MAINTAINER</span> masily<br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./my.cnf /etc/mysql/my.cnf</span><br><span class="hljs-comment">#ADD ./slave-1/mysql-files /var/lib/mysql-files/</span><br></code></pre></td></tr></table></figure>

<p>my.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[mysqld]<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 设置server_id，一般设置为IP，注意要唯一</span></span><br>server-id = 11<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span></span><br>log-bin = mysql-bin<br></code></pre></td></tr></table></figure>

<ul>
<li>slave-2中DockerFile和my.cnf</li>
</ul>
<p>DockerFile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> mysql:latest<br><span class="hljs-keyword">MAINTAINER</span> masily<br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./my.cnf /etc/mysql/my.cnf</span><br><span class="hljs-comment">#ADD ./slave-2/mysql-files /var/lib/mysql-files/</span><br></code></pre></td></tr></table></figure>

<p>my.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[mysqld]<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 设置server_id，一般设置为IP，注意要唯一</span></span><br>server-id = 12<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span></span><br>log-bin = mysql-bin<br></code></pre></td></tr></table></figure>

<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><ul>
<li><p>运行 <code>docker-compose up -d</code></p>
</li>
<li><p>停止 <code>docker-compose down</code></p>
</li>
<li><p><code>master</code> 配置</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">#<br>添加用户<span class="hljs-operator">/</span>权限<br><span class="hljs-keyword">CREATE</span><br><span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">WITH</span> <span class="hljs-string">&#x27;mysql_native_password&#x27;</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;#创建用户<br><br><span class="hljs-keyword">GRANT</span> REPLICATION SLAVE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;#分配权限<br><br>FLUSH PRIVILEGES;#刷新权限<br><br># 查看主库状态<br><span class="hljs-keyword">SHOW</span> MASTER STATUS;<br><br><span class="hljs-keyword">SHOW</span><br>VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%server_uuid%&#x27;</span>;<br><span class="hljs-keyword">SHOW</span><br>VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%server_id%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>slave</code> 配置(所有从库都一样)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span><br>SLAVE STATUS;<br>STOP<br>SLAVE;<br>CHANGE<br>MASTER <span class="hljs-keyword">TO</span> MASTER_HOST <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql-master&#x27;</span>,<br>MASTER_USER <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;repl&#x27;</span>,<br>MASTER_PASSWORD <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;123456&#x27;</span>,<br>MASTER_LOG_FILE <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql-bin.000003&#x27;</span>,<br>MASTER_LOG_POS <span class="hljs-operator">=</span> <span class="hljs-number">818</span>;<br><span class="hljs-keyword">START</span><br>SLAVE;<br><br><span class="hljs-keyword">SHOW</span><br>VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%server_uuid%&#x27;</span>;<br><span class="hljs-keyword">SHOW</span><br>VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%server_id%&#x27;</span>;<br></code></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item">12 分钟读完 (大约1772个字)</span></div></div><div class="content"><h1 id="主从复制、读写分离"><a href="#主从复制、读写分离" class="headerlink" title="主从复制、读写分离"></a>主从复制、读写分离</h1><h2 id="基本环境"><a href="#基本环境" class="headerlink" title="基本环境"></a>基本环境</h2><ul>
<li><code>java</code>: <code>1.8</code></li>
<li><code>maven</code>：<code>3.6.0</code></li>
<li><code>mysql</code>: <code>8.0</code></li>
<li><code>springboot</code>:<code>2.4.4</code></li>
<li><code>docker</code>: <code>20.10.5</code></li>
<li><code>docker-compose</code>: <code>1.28.5</code></li>
<li><code>sharding-jdbc</code>: <code>sharding-jdbc-spring-boot-starter:4.1.1</code></li>
</ul>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><ul>
<li>目录结构  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs text">主从复制<br> │  docker-compose.yml<br> │<br> ├─master<br> │      Dockerfile<br> │      my.cnf<br> │<br> ├─slave-1<br> │      Dockerfile<br> │      my.cnf<br> │<br> └─slave-2<br>         Dockerfile<br>         my.cnf<br></code></pre></td></tr></table></figure></li>
<li><code>docker-compose.yml</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br><br>  <span class="hljs-attr">master:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">./master</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql-master:1.0</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./master/mysql-files:/var/lib/mysql-files/&quot;</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-master</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">slave-1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">slave-2</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;33077:3306&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">mysql-master</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span><br><br>  <span class="hljs-attr">slave-1:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">./slave-1</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql-slave-1:1.0</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./slave-1/mysql-files:/var/lib/mysql-files/&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;33070:3306&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">mysql-slave-1</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-slave-1</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span><br><br>  <span class="hljs-attr">slave-2:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">./slave-2</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql-slave-2:1.0</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./slave-2/mysql-files:/var/lib/mysql-files/&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;33071:3306&quot;</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">mysql-slave-2</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-slave-2</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>master中DockerFile和my.cnf</li>
</ul>
<p>DockerFile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> mysql:latest<br><span class="hljs-keyword">MAINTAINER</span> masily<br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./my.cnf /etc/mysql/my.cnf</span><br><span class="hljs-comment">#ADD ./master/mysql-files /var/lib/mysql-files/</span><br></code></pre></td></tr></table></figure>

<p>my.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">[mysqld]<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 设置server_id，一般设置为IP，注意要唯一</span></span><br>server-id = 10<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span></span><br>log-bin = mysql-bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 主从复制的格式（mixed,statement,row，默认格式是statement）</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># binlog_format = row</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li>slave-1中DockerFile和my.cnf</li>
</ul>
<p>DockerFile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> mysql:latest<br><span class="hljs-keyword">MAINTAINER</span> masily<br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./my.cnf /etc/mysql/my.cnf</span><br><span class="hljs-comment">#ADD ./slave-1/mysql-files /var/lib/mysql-files/</span><br></code></pre></td></tr></table></figure>

<p>my.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[mysqld]<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 设置server_id，一般设置为IP，注意要唯一</span></span><br>server-id = 11<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span></span><br>log-bin = mysql-bin<br></code></pre></td></tr></table></figure>

<ul>
<li>slave-2中DockerFile和my.cnf</li>
</ul>
<p>DockerFile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> mysql:latest<br><span class="hljs-keyword">MAINTAINER</span> masily<br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./my.cnf /etc/mysql/my.cnf</span><br><span class="hljs-comment">#ADD ./slave-2/mysql-files /var/lib/mysql-files/</span><br></code></pre></td></tr></table></figure>

<p>my.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[mysqld]<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 设置server_id，一般设置为IP，注意要唯一</span></span><br>server-id = 12<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span></span><br>log-bin = mysql-bin<br></code></pre></td></tr></table></figure>

<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><ul>
<li><p>运行 <code>docker-compose up -d</code></p>
</li>
<li><p>停止 <code>docker-compose down</code></p>
</li>
<li><p><code>master</code> 配置</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">#<br>添加用户<span class="hljs-operator">/</span>权限<br><span class="hljs-keyword">CREATE</span><br><span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">WITH</span> <span class="hljs-string">&#x27;mysql_native_password&#x27;</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;#创建用户<br><br><span class="hljs-keyword">GRANT</span> REPLICATION SLAVE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;#分配权限<br><br>FLUSH PRIVILEGES;#刷新权限<br><br># 查看主库状态<br><span class="hljs-keyword">SHOW</span> MASTER STATUS;<br><br><span class="hljs-keyword">SHOW</span><br>VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%server_uuid%&#x27;</span>;<br><span class="hljs-keyword">SHOW</span><br>VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%server_id%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>slave</code> 配置(所有从库都一样)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span><br>SLAVE STATUS;<br>STOP<br>SLAVE;<br>CHANGE<br>MASTER <span class="hljs-keyword">TO</span> MASTER_HOST <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql-master&#x27;</span>,<br>MASTER_USER <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;repl&#x27;</span>,<br>MASTER_PASSWORD <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;123456&#x27;</span>,<br>MASTER_LOG_FILE <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mysql-bin.000003&#x27;</span>,<br>MASTER_LOG_POS <span class="hljs-operator">=</span> <span class="hljs-number">818</span>;<br><span class="hljs-keyword">START</span><br>SLAVE;<br><br><span class="hljs-keyword">SHOW</span><br>VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%server_uuid%&#x27;</span>;<br><span class="hljs-keyword">SHOW</span><br>VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%server_id%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h2 id="读写分离环境配置"><a href="#读写分离环境配置" class="headerlink" title="读写分离环境配置"></a>读写分离环境配置</h2><h3 id="maven-依赖"><a href="#maven-依赖" class="headerlink" title="maven 依赖"></a>maven 依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 没有用druid使用该数据库连接池启动报错，后期排查 --&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;dependency&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--    &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--    &lt;version&gt;1.2.5&lt;/version&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;/dependency&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="yml-配置"><a href="#yml-配置" class="headerlink" title="yml 配置"></a>yml 配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">jpa:</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-string">mysql</span><br>    <span class="hljs-attr">hibernate:</span><br>      <span class="hljs-attr">ddl-auto:</span> <span class="hljs-string">update</span><br><br>  <span class="hljs-attr">shardingsphere:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># 数据源配置</span><br>    <span class="hljs-attr">datasource:</span><br>      <span class="hljs-attr">names:</span> <span class="hljs-string">ds0,ds1,ds2</span><br>      <span class="hljs-attr">ds0:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>        <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://localhost:33077/test?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>      <span class="hljs-attr">ds1:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>        <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://localhost:33070/test?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>      <span class="hljs-attr">ds2:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>        <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://localhost:33071/test?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-comment"># 读写分离</span><br>    <span class="hljs-attr">masterslave:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">ds</span><br>      <span class="hljs-comment"># 主库数据源名称</span><br>      <span class="hljs-attr">master-data-source-name:</span> <span class="hljs-string">ds0</span><br>      <span class="hljs-comment"># 从库数据源名称列表</span><br>      <span class="hljs-attr">slave-data-source-names:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">ds1</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">ds2</span><br>      <span class="hljs-comment"># 读写分离负载算法的属性配置</span><br>      <span class="hljs-attr">load-balance-algorithm-type:</span> <span class="hljs-string">ROUND_ROBIN</span><br>    <span class="hljs-attr">props:</span><br>      <span class="hljs-attr">sql.show:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>启动试试</p>
<p>complete！ 🎉🎉🎉</p>
</blockquote>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ol>
<li><p><strong>主从复制原理</strong></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6bgY6S"><img src="https://z3.ax1x.com/2021/03/24/6bgY6S.png" alt="6bgY6S.png"></a></p>
</li>
</ol>
<ul>
<li><p>主库更新事件写入到<code>binlog</code>中</p>
</li>
<li><p>从库发起连接，连接到主库</p>
</li>
<li><p>主库创建一个SQL线程（<code>binlog dump thread</code>线程），把发送<code>binlog</code>内容到从库中；从库创建两个线程</p>
</li>
<li><p>从库IO线程：当START SLAVE 执行后，从库创建一个I&#x2F;O线程，读取主库发送过来的<code>binlog</code>内容写入到<code>relay log</code>(中继日志)中</p>
</li>
<li><p>从库SQL线程：从库创建SQL线程，从<code>relay log</code>里读取内容从<code>Exec_Master_Log_Pos</code>位置开始执行读取到的更新事件，将更新内容写入到从库中</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6bw6yR"><img src="https://z3.ax1x.com/2021/03/24/6bw6yR.png" alt="6bw6yR.png"></a></p>
</li>
</ul>
<blockquote>
<p>主从同步事件有3种形式:statement、row、mixed。</p>
<ol>
<li>statement：会将对数据库操作的sql语句写入到binlog中。</li>
<li>row：会将每一条数据的变化写入到binlog中。</li>
<li>mixed：statement与row的混合。Mysql决定什么时候写statement格式的，什么时候写row格式的binlog。</li>
</ol>
</blockquote>
<ol start="2">
<li><strong>主从复制策略</strong></li>
</ol>
<ul>
<li>同步策略：Master会等待所有的Slave都回应后才会提交，这个主从的同步的性能会严重的影响。</li>
<li>半同步策略：Master至少会等待一个Slave回应后提交。</li>
<li>异步策略：Master不用等待Slave回应就可以提交。</li>
<li>延迟策略：Slave要落后于Master指定的时间。</li>
</ul>
<ol start="3">
<li><p><strong>解决主从延迟</strong></p>
<p>在使用的<code>sharding-jdbc</code>中已有处理机制，更新和查询处于同一事务的话，强行走主库</p>
<blockquote>
<p>主从复制有不同的复制策略，对于不同的场景的适应性也不同，对于数据的实时性要求很高，要求强一致性，可以采用同步复制策略，但是这样就会性能就会大打折扣。</p>
<p>若是主从复制采用异步复制，要求数据最终一致性，性能方面也会好很多。只能说，对于数据延迟的解决方案没有最好的方案，就看你的业务场景中哪种方案使比较适合的。</p>
</blockquote>
</li>
<li><p><strong>若是主从复制，达到了写性能的瓶颈？</strong></p>
</li>
</ol>
<ul>
<li>主从模式对于写少读多的场景确实非常大的优势，但是总会写操作达到瓶颈的时候，导致性能提不上去。</li>
<li>这时候可以在设计上进行解决采用分库分表的形式，对于业务数据比较大的数据库可以采用分表，使得数据表的存储的数据量达到一个合理的状态。</li>
<li>也可以采用分库，按照业务进行划分，这样对于单点的写，就会分成多点的写，性能方面也就会大大提高。</li>
</ul>
<ol start="5">
<li><strong>Mysql主从有什么优点？为什么要选择主从？</strong></li>
</ol>
<blockquote>
<p>高性能方面：主从复制通过水平扩展的方式，解决了原来单点故障的问题，并且原来的并发都集中到了一台Mysql服务器中，现在将单点负载分散到了多台机器上，实现读写分离，不会因为写操作过长锁表而导致读服务不能进行的问题，提高了服务器的整体性能。</p>
<p>可靠性方面：主从在对外提供服务的时候，若是主库挂了，会有通过主从切换，选择其中的一台Slave作为Master；若是Slave挂了，还有其它的Slave提供读服务，提高了系统的可靠性和稳定性。</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item">9 分钟读完 (大约1397个字)</span></div></div><div class="content"><h2 id="Spring-Could"><a href="#Spring-Could" class="headerlink" title="Spring Could"></a>Spring Could</h2><h3 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h3><h3 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h3><h3 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h3><p>微服务就是将一个项目中的小功能都分为一个个微小的服务，并且独立运行在自己的进程中，要用了再分别调用就行。</p>
<h3 id="Spring-Could-1"><a href="#Spring-Could-1" class="headerlink" title="Spring Could"></a>Spring Could</h3><p>SpringCloud及时一个大集合：包括了配置中心、注册中心、负责均衡、熔断处理等等一些成熟的框架，并用 Spring boot 的形式包装好，方便开发者使用。<br>框架集合</p>
<h3 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h3><p>配置中心，将系统中用到的一些配置信息存储到配置中心，方便维护，不用每次修改配置都重启服务。用的比较多的配置中心还有etcd、携程的 Apollo、Disconf。</p>
<h3 id="Spring-Cloud-Netflix"><a href="#Spring-Cloud-Netflix" class="headerlink" title="Spring Cloud Netflix"></a>Spring Cloud Netflix</h3><p>Netflix OSS 是一组开源的框架和组件库，是Netflix公司开发出来解决分布式系统的一些有趣的可扩展类库。Spring Cloud 把他们都放到 Spring Cloud Netflix 下，这是一个框架集合，它包括 Eureka 、Ribbon、Zuul、Hystrix 等。</p>
<h3 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h3><p>服务中心，这可以说是微服务架构的核心功能了，微服务部署之后，一定要有服务注册和发现的能力，Eureka 就是担任这个角色的。如果你用过 dubbo 的话，那一定知道 dubbo 中服务注册和发现的功能是用 zookeeper 来实现的。</p>
<h3 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h3><p>提供客户端负责均衡功能，例如一个服务提供者部署了 3 个实例，那么使用 Ribbon 可以指定负载均衡算法请求其中一个实例，Ribbon 如果配合 Eureka ，使用起来非常简单。</p>
<h3 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h3><p>熔断器，假设有 3 个服务提供实例，其中有一个实例由于某中原因挂掉了，那么当再有请求进来的时候，如果还是向这个实例上发请求，那将会导致请求积压阻塞，这个时候，熔断器就要发挥它的作用，将这个有问题的实例下线，这样一来，再有新的请求进来，就不会再发到这个有问题的实例上了。</p>
<h3 id="Zuul"><a href="#Zuul" class="headerlink" title="Zuul"></a>Zuul</h3><p>服务网关。主要实现了路由转发和过滤器功能，对于处理一些数据聚合、鉴权、监控、统计类的功能非常好用。</p>
<h3 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h3><p>也是服务网关，可以认为它是 Zuul 的下一代，无论从易用性和性能方便都有所提高，如果你的系统中还没有使用 Zuul ，并且准备上网关，可以直接选择 Gateway 。</p>
<h3 id="Spring-Cloud-Consul"><a href="#Spring-Cloud-Consul" class="headerlink" title="Spring Cloud Consul"></a>Spring Cloud Consul</h3><p>Consul 让服务注册和服务发现（通过 DNS 和 HTTP 接口）更加简单，甚至对于外部服务（例如SaaS）注册也一样。Spring Cloud Consul 可替代已有的 Spring Cloud Eureka。Eureka 2.x 版本也已经停止开发，并且 Spring Cloud 官方也建议用 Spring Cloud Consul 来替代，当然如果已经用了 Eureka 在项目中也没有关系，Eureka 已经足够稳定，正常使用没有任何问题。Spring Cloud Consul 可替代已有的 Spring Cloud Config ，当做配置中心使用。</p>
<h3 id="Spring-Cloud-Stream"><a href="#Spring-Cloud-Stream" class="headerlink" title="Spring Cloud Stream"></a>Spring Cloud Stream</h3><p>Spring Cloud Stream 是消息中间件组件，它集成了 kafka 和 rabbitmq 。如果你的系统中打算集成 kafka 或 rabbitmq，可以考虑使用 Stream 。</p>
<h3 id="Spring-Cloud-Bus"><a href="#Spring-Cloud-Bus" class="headerlink" title="Spring Cloud Bus"></a>Spring Cloud Bus</h3><p>消息总线，用于在集群（例如，配置变化事件）中传播状态变化，可与Spring Cloud Config联合实现热部署。集成了 Rabbitmq 和 kafka 。刚刚上面说到的 Stream 好像也是这个功能。没错，我们可以认为 Bus 是 Stream 的进一步封装，使用更简单。而 Stream 的灵活性更高。</p>
<h3 id="Spring-Cloud-Feign"><a href="#Spring-Cloud-Feign" class="headerlink" title="Spring Cloud Feign"></a>Spring Cloud Feign</h3><p>Feign是一种声明式、模板化的HTTP客户端。它可以用注解的方式简化 HTTP 请求，可以快速简单的请求服务提供接口。如果你还在使用 restTemplate 或者其他方式，不妨考虑一下 Feign。</p>
<h3 id="Spring-Cloud-Sleuth"><a href="#Spring-Cloud-Sleuth" class="headerlink" title="Spring Cloud Sleuth"></a>Spring Cloud Sleuth</h3><p>服务日志收集和链路追踪模块，封装了 Dapper 和 log-based 追踪以及 Zipkin 和 HTrace 操作。与之功能相同的框架还有 skywalking、Pinpoint，另外国内还有美团开源的 CAT，只不过 CAT 属于代码侵入的，需要开发人员在系统中做代码埋点，不过也更加灵活，更加精细。</p>
<h3 id="Spring-Cloud-Security"><a href="#Spring-Cloud-Security" class="headerlink" title="Spring Cloud Security"></a>Spring Cloud Security</h3><p>可用做授权服务、单点登录等。如果服务需要做权限控制，那除非你自己实现。不然用到最多的就是 shiro 和 Spring Security 。Spring Boot 中用的比较多的就是 Security，众多授权机制中属于 OAuth2 最为流行。Spring Cloud Security 就是将 Security、OAuth2 做了集成，方便使用。</p>
<h3 id="Spring-cloud-Hystrix-熔断器"><a href="#Spring-cloud-Hystrix-熔断器" class="headerlink" title="Spring cloud Hystrix 熔断器"></a>Spring cloud Hystrix 熔断器</h3><p>断路器(Cricuit Breaker)是一种能够在远程服务不可用时自动熔断(打开开关)，并在远程服务恢复时自动恢复(闭合开关)的设施。断路器(Cricuit Breaker)是一种能够在远程服务不可用时自动熔断(打开开关)，并在远程服务恢复时自动恢复(闭合开关)的设施，Spring Cloud通过Netflix的Hystrix组件提供断路器、资源隔离与自我修复功能。</p>
<p>Spring Cloud Zuul 服务网关</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item">几秒读完 (大约89个字)</span></div></div><div class="content"><h1 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h1><p>J.U.C并发包，即<code>java.util.concurrent</code>包，是JDK的核心工具包，是JDK1.5之后，由 Doug Lea实现并引入。</p>
<p>整个<code>java.util.concurrent</code>包，按照功能可以大致划分如下：</p>
<ul>
<li>juc-locks 锁框架</li>
<li>juc-atomic 原子类框架</li>
<li>juc-sync 同步器框架</li>
<li>juc-collections 集合框架</li>
<li>juc-executors 执行器框架</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-04-19T02:59:11.000Z" title="4/19/2022, 10:59:11 AM">2022-04-19</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.017Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/tool/">工具</a></span><span class="level-item">几秒读完 (大约71个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/tool-ssr">科学上网</a></h1><div class="content"><h2 id="金克拉"><a href="#金克拉" class="headerlink" title="金克拉"></a>金克拉</h2><p>记录几款科学上网地址。</p></div><a class="article-more button is-small is-size-7" href="/tool-ssr#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-04-14T08:32:59.000Z" title="4/14/2022, 4:32:59 PM">2022-04-14</time>发表</span><span class="level-item"><time dateTime="2022-05-07T06:04:46.013Z" title="5/7/2022, 2:04:46 PM">2022-05-07</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/flowable/">flowable</a></span><span class="level-item">2 分钟读完 (大约341个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/flowable-spring-boot">工作流引擎 flowable 在 Spring Boot 中使用</a></h1><div class="content"><p>工作流引擎用于流程控制，常出现在 <code>OA</code> 系统中。常见的工作流引擎有 <code>Activity</code>、<code>Flowable</code> 等。</p>
<blockquote>
<p>本文需对 <code>Flowable</code> 和 <code>BPMN2.0</code> 相关概念有一个大致的了解，参考 <a target="_blank" rel="noopener" href="https://www.flowable.com/open-source/docs/bpmn/ch05a-Spring-Boot">Getting Started · Flowable Open Source Documentation</a></p>
</blockquote></div><a class="article-more button is-small is-size-7" href="/flowable-spring-boot#more">阅读更多</a></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">上一页</a></div><div class="pagination-next"><a href="/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/logo/logo.png" alt="MASILY"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">MASILY</p><p class="is-size-6 is-block">学海无涯苦作舟</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">38</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">29</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/MASILY365" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/MASILY365/masily365.github.io"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Centos/"><span class="level-start"><span class="level-item">Centos</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Hexo/"><span class="level-start"><span class="level-item">Hexo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/IDEA/"><span class="level-start"><span class="level-item">IDEA</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="level-start"><span class="level-item">多线程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Jetbrains/"><span class="level-start"><span class="level-item">Jetbrains</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/MySQL/"><span class="level-start"><span class="level-item">MySQL</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/flowable/"><span class="level-start"><span class="level-item">flowable</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8A%9B%E6%89%A3/"><span class="level-start"><span class="level-item">力扣</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/tool/"><span class="level-start"><span class="level-item">工具</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="level-start"><span class="level-item">设计模式</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Arthas/"><span class="tag">Arthas</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Centos/"><span class="tag">Centos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Homebrew/"><span class="tag">Homebrew</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IDEA/"><span class="tag">IDEA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Jetbrains/"><span class="tag">Jetbrains</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mac/"><span class="tag">Mac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NVM/"><span class="tag">NVM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SFTP/"><span class="tag">SFTP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SPI/"><span class="tag">SPI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSH/"><span class="tag">SSH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/crack/"><span class="tag">crack</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flowable/"><span class="tag">flowable</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/npm/"><span class="tag">npm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssr/"><span class="tag">ssr</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8A%9B%E6%89%A3/"><span class="tag">力扣</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"><span class="tag">单例模式</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">博客</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="tag">多线程</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">工具</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%83%AD%E9%83%A8%E7%BD%B2/"><span class="tag">热部署</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">算法</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BB%98%E5%9B%BE/"><span class="tag">绘图</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">设计模式</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">广告</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3160477308855244" data-ad-slot="1682004332" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-07T06:04:46.017Z">2022-05-07</time></p><p class="title"><a href="/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-07T06:04:46.017Z">2022-05-07</time></p><p class="title"><a href="/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-07T06:04:46.013Z">2022-05-07</time></p><p class="title"><a href="/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-07T06:04:46.013Z">2022-05-07</time></p><p class="title"><a href="/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-07T06:04:46.013Z">2022-05-07</time></p><p class="title"><a href="/"> </a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.svg" alt="MASILY" height="28"></a><p class="is-size-7"><span>&copy; 2022 masily</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/MASILY365/masily365.github.io"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>